<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PostHog Analytics Test</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-8">
  <div class="max-w-2xl mx-auto">
    <h1 class="text-3xl font-bold mb-6">PostHog Analytics Test</h1>
    
    <div class="bg-white rounded-lg shadow p-6 mb-4">
      <h2 class="text-xl font-semibold mb-4">Configuration</h2>
      <div class="space-y-2">
        <div>
          <label class="block text-sm font-medium mb-1">PostHog Key:</label>
          <input 
            id="posthogKey" 
            type="text" 
            placeholder="phc_..." 
            class="w-full p-2 border rounded"
          />
        </div>
        <button 
          id="initBtn" 
          class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
        >
          Initialize PostHog
        </button>
      </div>
    </div>

    <div class="bg-white rounded-lg shadow p-6 mb-4">
      <h2 class="text-xl font-semibold mb-4">Test Events</h2>
      <div class="space-y-2">
        <button 
          onclick="trackEvent('lesson_started', { lessonId: 'l1', title: 'Test Lesson' })" 
          class="w-full bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700"
        >
          Track: lesson_started
        </button>
        <button 
          onclick="trackEvent('lesson_completed', { lessonId: 'l1', score: 8, total: 10, crowns: 3 })" 
          class="w-full bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700"
        >
          Track: lesson_completed
        </button>
        <button 
          onclick="trackEvent('sim_case_started', { caseId: 'case-001' })" 
          class="w-full bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700"
        >
          Track: sim_case_started
        </button>
        <button 
          onclick="trackEvent('ai_feedback_received', { caseId: 'case-001', cached: false })" 
          class="w-full bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700"
        >
          Track: ai_feedback_received
        </button>
        <button 
          onclick="trackEvent('next_best_lesson_clicked', { lessonId: 'l5' })" 
          class="w-full bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700"
        >
          Track: next_best_lesson_clicked
        </button>
      </div>
    </div>

    <div class="bg-white rounded-lg shadow p-6">
      <h2 class="text-xl font-semibold mb-4">Console Log</h2>
      <div id="log" class="bg-gray-100 p-4 rounded font-mono text-sm h-64 overflow-auto"></div>
    </div>
  </div>

  <script src="https://unpkg.com/posthog-js@1.96.1/dist/array.full.js"></script>
  <script>
    const logEl = document.getElementById('log');
    
    function log(msg) {
      const time = new Date().toLocaleTimeString();
      logEl.innerHTML += `[${time}] ${msg}\n`;
      logEl.scrollTop = logEl.scrollHeight;
      console.log(msg);
    }

    document.getElementById('initBtn').addEventListener('click', () => {
      const key = document.getElementById('posthogKey').value;
      if (!key) {
        log('‚ùå Error: Please enter a PostHog key');
        return;
      }
      
      try {
        posthog.init(key, { 
          api_host: 'https://app.posthog.com',
          capture_pageview: true 
        });
        log('‚úÖ PostHog initialized');
        log(`üìä Pageview captured automatically`);
      } catch (err) {
        log(`‚ùå Init failed: ${err.message}`);
      }
    });

    function trackEvent(name, props) {
      if (!window.posthog || !posthog._isInitialized) {
        log('‚ùå PostHog not initialized. Click "Initialize PostHog" first.');
        return;
      }
      
      try {
        posthog.capture(name, props);
        log(`‚úÖ Event tracked: ${name}`);
        log(`   Props: ${JSON.stringify(props)}`);
      } catch (err) {
        log(`‚ùå Track failed: ${err.message}`);
      }
    }

    // Check for key in URL params
    const params = new URLSearchParams(window.location.search);
    const keyParam = params.get('key');
    if (keyParam) {
      document.getElementById('posthogKey').value = keyParam;
      log('üîë Key loaded from URL parameter');
    }

    log('üìù Ready to test PostHog analytics');
    log('üí° Tip: Add ?key=YOUR_KEY to URL for quick testing');
  </script>
</body>
</html>
